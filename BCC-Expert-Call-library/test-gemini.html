<!DOCTYPE html>
<html>
<head>
  <title>Gemini API è¿é€šæ€§æµ‹è¯•</title>
  <style>
    body { font-family: -apple-system, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; }
    .result { padding: 15px; border-radius: 8px; margin: 15px 0; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #e2e3e5; color: #383d41; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 5px; }
    input { padding: 10px; width: 100%; font-size: 14px; margin: 10px 0; }
    pre { background: #f4f4f4; padding: 10px; overflow-x: auto; font-size: 12px; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Gemini API è¿é€šæ€§æµ‹è¯•</h1>
  
  <h3>1. è¾“å…¥ Gemini API Key</h3>
  <input type="text" id="apiKey" placeholder="AIzaSy..." value="">
  
  <h3>2. è¿è¡Œæµ‹è¯•</h3>
  <button onclick="testGeminiDirect()">æµ‹è¯• Gemini API ç›´è¿</button>
  <button onclick="testEdgeFunction()">æµ‹è¯• Edge Function</button>
  
  <div id="results"></div>

  <script>
    const SUPABASE_URL = 'https://rybiwfmmnauzypkrtafs.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5Yml3Zm1tbmF1enlwa3J0YWZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NzU3MTUsImV4cCI6MjA4NTE1MTcxNX0.qb7FUvCjzojTQ5RNY-a3lCarhkV3Lf2c90hQ5Mhd79Y';

    function log(msg, type = 'info') {
      const div = document.createElement('div');
      div.className = 'result ' + type;
      div.innerHTML = msg;
      document.getElementById('results').appendChild(div);
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '';
    }

    // æµ‹è¯• 1: ç›´æ¥è°ƒç”¨ Gemini API
    async function testGeminiDirect() {
      clearResults();
      const apiKey = document.getElementById('apiKey').value.trim();
      
      if (!apiKey) {
        log('âŒ è¯·è¾“å…¥ API Key', 'error');
        return;
      }

      log('ğŸ”„ æ­£åœ¨ç›´æ¥æµ‹è¯• Gemini API...', 'info');
      
      try {
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: 'Say hello in Chinese' }] }]
            })
          }
        );

        const data = await response.json();
        
        if (response.ok) {
          const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response';
          log(`âœ… Gemini API ç›´è¿æˆåŠŸï¼<br>å“åº”: ${text}`, 'success');
          log(`<pre>${JSON.stringify(data, null, 2)}</pre>`, 'info');
        } else {
          log(`âŒ Gemini API é”™è¯¯ (${response.status})<br><pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
        }
      } catch (err) {
        log(`âŒ ç½‘ç»œé”™è¯¯: ${err.message}`, 'error');
      }
    }

    // æµ‹è¯• 2: é€šè¿‡ Edge Function è°ƒç”¨
    async function testEdgeFunction() {
      clearResults();
      log('ğŸ”„ æ­£åœ¨æµ‹è¯• Edge Function...', 'info');

      try {
        const response = await fetch(
          `${SUPABASE_URL}/functions/v1/gemini-proxy`,
          {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
              'apikey': SUPABASE_ANON_KEY
            },
            body: JSON.stringify({
              action: 'query',
              prompt: 'Say hello',
              context: '<document>Test</document>'
            })
          }
        );

        const text = await response.text();
        
        if (response.ok) {
          log(`âœ… Edge Function è°ƒç”¨æˆåŠŸï¼<br><pre>${text}</pre>`, 'success');
        } else {
          log(`âŒ Edge Function é”™è¯¯ (${response.status})<br><pre>${text}</pre>`, 'error');
          
          // å°è¯•è·å–æ›´å¤šé”™è¯¯ä¿¡æ¯
          log(`<br>ğŸ’¡ æç¤ºï¼šæ£€æŸ¥ Supabase Dashboard > Edge Functions > gemini-proxy > Logs æŸ¥çœ‹è¯¦ç»†é”™è¯¯`, 'info');
        }
      } catch (err) {
        log(`âŒ ç½‘ç»œé”™è¯¯: ${err.message}`, 'error');
      }
    }
  </script>
</body>
</html>
